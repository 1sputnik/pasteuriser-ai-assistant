***<h1 align = "center">Data Manipulator</a>***

# Содержание

1) [О DataManipulator](#о-datamanipulator) 
2) [Представление данных](#представление-данных)  
    2.1 [Чтение данных](#чтение-данных)  
    2.2 [Обрезка данных](#обрезка-данных)  
    2.5 [Визуализация данных]()  
    2.6 [Сохранение данных](#сохранение-данных)
3) [Обработка данных](#обработка-данных)

# О DataManipulator

<p align = "justify">
Модуль DataManipulator предназначен для обеспечения чтения, сохранения и обработки данных. Модуль предоставляет возможности для работы с последовательностями как OCDF-данных, так и TDF-данных. DataManipulator необходим для подготовки данных для работы в модулях анализа таких как Forecaster.
</p>

<p align = "justify">
Однако, прежде чем говорить о функциях и возможностях модуля, необходимо понять, с какими форматами данных этот модуль работает.
</p>

# Представление данных

<p align = "justify">
Было решено создать два формата данных. Первый формат предназначается для хранения значений всего одного датчика и обозначается OCDF. Он состоит из трёх значений: номер сида, дискретное время и значение датчика. Однако данный формат также можно использовать и для работы с данными всех сидов, которые подходят под данный формат данных. Тогда значение номера сида будет различаться.  
</p>

|cid|time|value|
|---|----|-----|
|1|24|100|
|1|25|99|
|1|30|95|
|1|31|96|

<p align = "justify">
Второй формат представляет собой таблицу данных, где собраны значения всех сидов во времени. Формат обозначается как TDF. Он состоит из семи значений: дискретное время, значение 1-ого сида, значение 2-ого сида, значение 3-ого сида, значение 4-ого сида, значение 5-ого сида, значение 6-ого сида. Данный формат очень легко представить в виде таблицы. 
</p>

|time|VC1|VC2|VC3|VC4|VC5|VC6|
|----|---|---|---|---|---|---|
|100|100|23|43|45|65|33|
|102|100|34|41|43|78|45|
|104|99|23|43|45|65|47|
|106|34|12|14|3|54|34|

VCX - value of cid X 

# Обработка данных

<p align = "justify">
DataManipulator имеет различные функции для обработки данных формата OCDF и TDF, для сборки данных TDF формата, а также для сохранения данных в текстовом или бинарном виде. Ниже будет полностью развёрнуто меню функций и возможностей модуля. 
</p>

Главное меню:  
1) Работа с OCDF-форматом.  
    1.1 Обрезка заданного процента данных.  
    1.2 Обрезка заданного количества данных.  
    1.3 Выравниевание диапазонов по оси времени.  
    1.4 Визуализация данных.  
    1.5 Парсинг данных по сиду.  
    1.6 Добавление новых данных.  
    1.7 Сохранение данных в csv-файл.  
    1.8 Сохранение данных в bin-файл.  
    1.9 Выход в главное меню.  
2) Работа с TDF-форматом.  
    2.1 Обрезка заданного процента данных.  
    2.2 Обрезка заданного количества данных.  
    2.3 Визуализация данных.  
    2.4 Парсинг данных по сиду.  
    2.5 Добавление новых данных.  
    2.6 Сохранение данных в csv-файл.  
    2.7 Сохранение данных в bin-файл.  
    2.8 Выход в главное меню.  
3) Сборка TDF-формата из общего файла OCDF-формата.  
4) Информация о модуле.  
5) Выход из программы.

## Чтение данных

<p align = "justify">
Чтение данных происходит, когда выбивается 1-ый, 2-ой и 3-ий пункт главного меню. Да, перед тем, как перейти к обработке данных выбранного формата, эти данные необходимо считать. При чтении данных будет возможность указать имя файла, из которого будут считываться данные, и количество данных, которые нужно считать. Если же необходимо считать все данные, то можно просто ввести 0 - этакое магическое число, при вводе которого функция понимает, что надо считать все данные. При этом, если ввести число, превышающее количество данных в файле, то считаются просто все данные.
</p>

Пример чтения OCDF-данных (1-ый пункт меню):  
![read OCDF](images_for_readme/readOCDF.jpg)

Пример чтения TDF-данных (2-ый пункт меню):  
![read TDF](images_for_readme/readTDF.jpg)

<p align = "justify">
Как можно заметить, функции чтения способны различать текстовые и бинарные форматы и считывать данные в соответствующем режиме.
</p>

<p align = "justify">
На счёт 3-его пункта главного меню. Функция чтения вызывается для считывания общего OCDF-файла. А что такое общий OCDF-файл? Это файл, данные которого хранятся в формате OCDF и содержит в себе данные всех шести сидов.  
</p>

## Обрезка данных

<p align = "justify">
На данный момент имеется возможность обрезать данные и сохранить некоторых их диапазон. Обрезать данные можно указав их количество, которое необходимо отсавить, либо процент данных, сколько необходимо отсавить. 
</p>

Пример обрезки по заданному проценту:

![cut percent](images_for_readme/cutPercent.jpg)

<p align = "justify">
Как можно заметить, программа предлагает возможность обрезать данные либо слева направо, либо справа налево. Это сделано для того, чтобы было удобно делить данные на обучающий и зарезервированные надоры данных. 
</p>

Пример обрезки по заданному количеству данных:

![cut quantity](images_for_readme/cutQuantity.jpg)

<p align = "justify">
Данные функции работают как с OCDF, так и с TDF форматом. 
</p>

## Визуализация данных

<p align = "justify">
Визаулизация данных выполняется с помощью python-модулей, находящихся в папке ..\PyVisualisation. Модуль предоаставляет возможность визуализировать даныные как OCDF, так и TDF формата. Примеры:
</p>

### Визуализация данных OCDF формата с одним сидом

![visual OCDF](images_for_readme/visualOCDF.png)

<p align = "justify">
Как можно увидеть, модуль предоставляет информативные графики. Ось абсцисс подписана и обозначает дисректное время, измеряемое в секундах. Ось ординат для кажого сида своя. То, как подписать ось ординат программа решает на основе переданных модулю данных определённого сида. В свою очередь номер сида указывается в загаловке графика.  
</p>

### Визуализация данных OCDF формата с несколькими сидами

<p align = "justify">
Как известно, в файлах OCDF формата могут быть данные разных сидов. Но и с такой проблемой модуль способен разобраться. Пример: 
</p>

![visual OCDF two cids](images_for_readme/visualTwoCids.png)

<p align = "justify">
В заголовке можно уже видеть, что указаны номера двух сидов, но информации у оси ординат о них уже нет. Информация о сидах выводится в легенде в левом верхнем углу визуализации. 
</p>

### Визуализация TDF формата

![visual OCDF two cids](images_for_readme/visualTDF.png)

<p align = "justify">
В заголовке можно уже видеть, что указаны номера двух сидов, но информации у оси ординат о них уже нет. Информация о сидах выводится в легенде в левом верхнем углу визуализации. 
</p>

### Управление визуализацией

<p align = "justify">
Имеется возможность масштабирования полученных изображений. Ниже перечисленны комбинации для регулирования масштаба в окне визуализации:
</p>

Вращение колёсика мыши (далее КМ):  

<p align = "justify">
1. вращение вверх КМ (ввКМ) - позволяет приблизить изображение (уменьшить масштаб).
</p>

<p align = "justify">
2. вращение вниз КМ (внКМ) - позволяет отдалить изображение (увеличить масштаб).
</p>

<p align = "justify">
3. Shift + вращение КМ - позволяет расширить/сузить изображение по ширине (увеличить/уменьшить масштаб по оси абсцис).
</p>

<p align = "justify">
4. Ctrl + вращение КМ - позволяет расширить/сузить изображение по высоте (увеличить/уменьшить масштаб по оси ординат).
</p>

## Сохранение данных

<p align = "justify">
Обработанные данные можно сохранить либо в текстовом виде, либо в бинарном виде. Для этого достаточно выбрать соответствующий пункт меню. 
</p>

# Трудности сборки TDF-формата

<p align = "justify">
Данный формат собирается из файла, который содержит в себе все сиды и подходит под формат OCDF-данных. При сборке данных, возникает проблема того, что в некоторые моменты времени не определены значения для некоторых датчиков. Это выглядит следующим образом:
</p>

|time|VC1|VC2|VC3|VC4|VC5|VC6|
|----|---|---|---|---|---|---|
|100|100||||||
|103|||41||||
|105||23||||
|110||||||34|

<p align = "justify">
Для решения данной задачи необходимо выполнить следующие действия: определить, данные какого сида появляются позже остальных и обрезать данные других сидов до первого момента времени появления позднейшего сида. Второй шаг похож на первый, но теперь работаем с концами последовательностей. Необходимо определить самый ранний заканчивающийся сид и обрезать концы других сидов до момента окончания самого раннего сида. Далее необходимо воспользоваться функцией выравнивания диапазонов по оси времени для каждой цепочки OCDF-данных. Это необходимо, чтобы в таблице не было пустых ячеек. Далее склеиваем все последовательности в TDF-формат. Пример таких данных уже был показан выше.
</p>

# Будущее модуля

<p align = "justify">
Модуль планируется постоянно развивать и добавлять новые функции для обработки данных. Также в дальнейшем же планируется добавить возможность выделять и работать с аномалиями в данных. 
</p>